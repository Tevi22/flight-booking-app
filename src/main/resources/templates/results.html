<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: commonHead('Search Results | TevinAir')}"></head>

<body class="bg-light">

    <!-- Header -->
    <header th:replace="~{fragments/header :: header}">
    </header>

    <!-- Main Content -->
    <main class="hero" id="results">

        <!-- Search Summary -->
        <section class="mb-5" id="search-summary">
            <h2 class="h4">Your Search Details</h2>
            <div class="bg-white border rounded p-3 shadow-sm">
                <p><strong>From:</strong> <span th:text="${searchRequest.from}"></span></p>
                <p><strong>To:</strong> <span th:text="${searchRequest.to}"></span></p>
                <p><strong>Departure Date:</strong> <span th:text="${searchRequest.departDate}"></span></p>
                <p><strong>Return Date:</strong> <span th:text="${searchRequest.returnDate}"></span></p>
                <p><strong>Passengers:</strong> <span th:text="${searchRequest.passengers}"></span></p>
                <p><strong>Children:</strong> <span th:text="${searchRequest.children}"></span></p>
            </div>
        </section>

        <!-- Available Flights -->
        <section class="container" id="available-flights">
            <h2 class="h4 mb-3">Available Flights</h2>

            <!-- Show a friendly message when the search returns no flights -->
            <div th:if="${noResultsMessage != null}" class="alert alert-warning text-center" role="alert">
                <span th:text="${noResultsMessage}"></span>
                <div class="mt-2">
                    Try a different date (or broaden your date range) and search again.
                </div>
                <div>
                    <a th:href="@{/search}" class="btn btn-primary mt-3">New Search</a>
                </div>
            </div>

            <!-- Only show sorting + table when we actually have results -->
            <div th:if="${flights != null and !#lists.isEmpty(flights)}">

                <!-- Sorting Info -->
                <div class="mb-3">
                    <label id="sortLabel">Showing results sorted by: Default</label>
                    <select id="sortBy" class="form-select" style="width: 200px;">
                    <option value="default">Default</option>
                    <option value="priceAsc">Price: Low to High</option>
                    <option value="priceDesc">Price: High to Low</option>
                </select>
                </div>

                <div class="table-responsive bg-white rounded shadow-sm">
                    <table class="table table-hover table-bordered mb-0" id="flightsTable" th:if="${!#lists.isEmpty(flights)}">
                        <thead class="table-light">
                            <tr>
                                <th>Airline</th>
                                <th>Flight #</th>
                                <th>Route</th>
                                <th>Departure</th>
                                <th>Seats</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="flight : ${flights}">
                                <!-- Airline: keep as a constant label to avoid needing a DB field -->
                                <td>TevinAir</td>

                                <!-- FlightEntity.flightNumber -->
                                <td th:text="${flight.flightNumber}"></td>

                                <!-- FlightEntity.origin + FlightEntity.destination -->
                                <td>
                                    <span th:text="${flight.origin}"></span> &rarr;
                                    <span th:text="${flight.destination}"></span>
                                </td>

                                <!-- FlightEntity.departureDate -->
                                <td th:text="${flight.departureDate}"></td>

                                <!-- FlightEntity.availableSeats (keep class='seats' so JS sort still works) -->
                                <td th:text="${flight.availableSeats}" class="seats"></td>

                                <!-- FlightEntity.price (keep class='price' so JS sort still works) -->
                                <td th:text="${flight.price}" class="price"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <form th:action="@{/book}" method="post" class="mt-4" th:if="${flights != null and !#lists.isEmpty(flights)}">
                <input type="hidden " placeholder="flightId" name="flightId" th:value="${flight.id} " th:if="${flight != null and flight.id != null} " />
                <input type="hidden " name="passengers " placeholder="passengers" th:value="${passengers} " />
                <input type="hidden " name="children " placeholder="children" th:value="${children} " />
                <button type="submit ">Book Flight</button>
            </form>
        </section>
    </main>

    <!-- Footer -->
    <footer th:replace="~{fragments/footer :: footer} ">
    </footer>

    <!-- Custom JS for Sorting Flights -->
    <script th:src="@{/js/sort-flight.js} "></script>

    <!-- Bootstrap JS -->
    <div th:replace="~{fragments/scripts :: commonScripts} "></div>
</body>

</html>